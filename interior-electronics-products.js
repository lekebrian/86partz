window.CategoryProducts = {
  products: [
    {
      id: 601,
      name: 'Subaru BRZ Sport Performance Steering Wheel (Blue & Black)',
      price: 329,
      image: '41a.jpg',
      images: ['41b.jpg', '41c.jpg'],
      description: `Elevate the interior aesthetics and driving experience of your Subaru BRZ with this striking sport performance steering wheel. Expertly finished in a premium two-tone blue and black design, this wheel offers a distinctive visual upgrade and an enhanced tactile feel. Crafted from high-quality, durable materials, it provides a comfortable and secure grip, designed to improve hand placement and foster a more engaging connection to the road. This steering wheel is engineered for seamless installation into your Subaru BRZ, integrating perfectly with your vehicle's existing setup. It represents an ideal enhancement for enthusiasts seeking to personalize their vehicle's cockpit with a touch of unique style and a significant upgrade in driving dynamics.`
    },
    {
      id: 602,
      name: 'Greddy limited edition steering wheel',
      price: 380,
      image: '42a.jpg',
      images: ['42b.jpg', '42c.jpg'],
      description:`
Enhance your driving experience and elevate your vehicle's interior with this comprehensive Greddy Limited Edition steering wheel package. This exclusive set features a premium Greddy Limited Edition Alcantara Momo steering wheel, meticulously paired with a Works Bell 540S short boss for precise fitment. Designed specifically for the Subaru BRZ, Toyota 86, or Scion FR-S, this package ensures seamless integration and optimal driving ergonomics. Further elevating its functionality, the ensemble includes a Greddy/Works Bell collaboration quick disconnect hub, allowing for rapid and secure steering wheel removal. All components are in excellent condition, promising reliability and peak performance. For a complete installation, two Works Bell airbag resistors are included, as required for proper system functionality. This is an unparalleled opportunity for enthusiasts seeking a top-tier steering solution that combines iconic design with advanced engineering.`
    },
    {
      id: 603,
      name: 'Carbon Fiber Steering Wheel for Subaru BRZ, Scion FR-S, and Toyota 86',
      price: 299,
      image: '43a.jpg',
      images: ['43b.jpg', '43c.jpg'],
      description: `Elevate the interior of your sport compact with this distinctive carbon fiber steering wheel. Offered in good, used condition, this wheel provides a significant aesthetic and tactile upgrade for the Subaru BRZ, Scion FR-S, and Toyota 86 platforms. Its premium carbon fiber construction delivers a sophisticated, performance-oriented look and feel, enhancing your connection to the vehicle. This accessory is designed for direct compatibility with all listed models, ensuring a straightforward upgrade. Installation assistance is available to facilitate a smooth transition.`
    },
    {
      id: 604,
      name: 'Link ECU AIM MXS Strada Dash',
      price: 950,
      image: '44a.jpg',
      images: ['44b.jpg', '44c.jpg'],
      description: `Experience unparalleled data visualization and control with this brand-new, never-installed Link ECU AIM MXS Strada Dash. This advanced digital display is designed for seamless integration with Link ECUs, offering a crystal-clear, high-contrast screen that presents vital engine and vehicle information with exceptional clarity. Included with this pristine unit is a custom dash insert, ensuring a perfect and professional fit within your vehicle's interior. To further enhance its comprehensive functionality, a high-precision GPS module is also provided, enabling accurate speed, lap timing, and track mapping capabilities without the need for additional sensors. This complete package represents a premier solution for enthusiasts and racers demanding precise monitoring and an elevated cockpit experience, ready for immediate installation and operation.`
    },
    {
      id: 605,
      name: 'PCI Racing Slider Seat Mount – Driver Side for GR86, BRZ, FR-S, and 86',
      price: 250,
      image: '45a.jpg',
      images: ['45b.jpg', '45c.jpg'],
      description: `Optimize your driving position and enhance safety with this high-quality PCI Racing Slider Seat Mount, specifically designed for the driver's side of the GR86, BRZ, FR-S, and 86 platforms. This robust seat mount incorporates a smooth-operating slider mechanism, allowing for precise and easy adjustment of your seating position to achieve optimal ergonomics and control. Manufactured to exacting standards, this component ensures a secure and stable foundation for your aftermarket seat. It is offered in excellent condition, free from any issues, ready to provide a direct and reliable upgrade to your vehicle's interior. This mount is an essential component for enthusiasts looking to install performance seating while maintaining convenient adjustability.

`
    },
    {
      id: 606,
      name: 'RECARO Japan SR-6 GK100S Recliner Set (Black/Red Glass Mesh)',
      price: 1200,
      image: '46a.jpg',
      images: ['46b.jpg', '46c.jpg'],
      description:`Acquire a highly sought-after and now discontinued set of RECARO Japan SR-6 GK100S Recliner seats. This exclusive pair, designed for both driver and passenger, features a distinctive black and red color scheme with breathable glass mesh fabric, combining iconic RECARO aesthetics with superior comfort and support. The SR-6 series is renowned for its excellent lateral support, making it ideal for performance driving while retaining the convenience of a reclining mechanism for daily usability. These seats represent a unique chance to enhance your vehicle's interior with genuine, high-performance RECARO components that are no longer in production, offering both exceptional ergonomics and a significant upgrade in cabin appeal.`
    },
    {
      id: 607,
      name: 'Custom Carbon Fiber and Alcantara D-Shape Steering Wheel for FR-S/BRZ',
      price: 280,
      image: '48a.jpg',
      images: ['48b.jpg'],
      description: `Elevate your driving experience and the interior aesthetic of your FR-S or BRZ with this exquisite, brand-new custom steering wheel. Meticulously crafted, this wheel features a sophisticated carbon fiber weave, complemented by luxurious Alcantara on the sides and bolsters for an enhanced grip and premium tactile feel. A vibrant yellow stripe at the 12 o'clock position provides a sporty visual cue, while its modern D-shape design offers improved legroom and a distinct racing-inspired look. Though never installed, its pristine condition ensures a flawless upgrade for your vehicle. Included with this exceptional wheel is a custom Alcantara steering wheel cover, providing protection and maintaining its pristine appearance. This is an unparalleled opportunity to personalize your cockpit with a truly bespoke and high-performance component.

`
    },
    {
      id: 608,
      name: '2020 Subaru BRZ Door Cards and Alcantara Dash Piece ',
      price: 300,
      image: '47a.jpg',
      images: ['47b.jpg', '47c.jpg'],
      description: `Elevate the interior of your BRZ with this exceptionally well-preserved set of 2020 Subaru BRZ door cards, complemented by a luxurious Alcantara dash piece. These components, removed from a BRZ, are in perfect condition, showing no signs of wear or issues, ensuring a seamless and high-quality upgrade for your vehicle's cabin. The Alcantara dash piece specifically adds a touch of sophisticated texture and premium feel to your dashboard, perfectly matching the sporty elegance of the BRZ interior. This complete package offers an ideal opportunity for enthusiasts to restore or enhance their vehicle's aesthetic with genuine, unblemished OEM-quality components, ready for immediate installation.`
    },
    {
      id: 609,
      name: 'Toyota 86 / Subaru BRZ (2017+) OEM Head Unit',
      price: 199,
      image: '49a.jpg',
      images: ['49b.jpg', '49c.jpg'],
      description: `Upgrade or replace your vehicle's audio and infotainment system with this genuine OEM head unit, specifically designed for 2017 and newer Toyota 86 and Subaru BRZ models. This unit is in perfect, unblemished condition, ensuring seamless functionality and a like-new appearance for your dashboard. It offers a direct-fit solution, providing all the standard features and connectivity you expect from an original equipment component. This is an ideal opportunity for enthusiasts seeking a flawless replacement or an upgrade to the refreshed infotainment system found in later models, ready for immediate installation`
    },
    {
      id: 610,
      name: 'Authentic Recaro RS-GS Red Bucket Seats with PCI Sliding Rails (Pair)',
      price: 1000,
      image: '50a.jpg',
      images: ['50b.jpg', '50c.jpg'],
      description: `Experience unparalleled support and iconic style with this exceptional pair of authentic Recaro RS-GS red bucket seats, offered in great condition. These highly regarded fixed-back seats are engineered to provide superior lateral support and feedback, making them ideal for performance driving while significantly enhancing your vehicle's interior aesthetic. This set includes PCI sliding rails for both the driver and passenger sides, specifically designed for seamless installation into FR-S and BRZ models. The integrated upgraded safety hardware ensures secure mounting and peace of mind. Designed to comfortably accommodate individuals with waists ranging from 30 to 34 inches, this package offers a complete, ready-to-install solution for enthusiasts seeking a definitive upgrade in both cabin presence and driving dynamics.

`
    },
   
  ],
  productsPerPage: 5,
  currentPage: 1,
  renderProducts: function(page) {
    const grid = document.getElementById('categoryProducts');
    if (!grid) return;
    const start = (page - 1) * this.productsPerPage;
    const end = start + this.productsPerPage;
    const productsToShow = this.products.slice(start, end);
    grid.innerHTML = '';
    productsToShow.forEach((product, idx) => {
      const card = document.createElement('div');
      card.className = 'product-card';
      card.setAttribute('data-product-id', product.id);
      card.innerHTML = `
        <img src="${product.image}" alt="${product.name}" class="product-image">
        <div class="product-info">
          <h3 class="product-title">${product.name}</h3>
          <div class="product-price">$${product.price}</div>
          <div style="display:flex;gap:0.5em;align-items:center;margin-bottom:0.5em;">
            <button class="btn btn-small see-details-btn" data-id="${product.id}">See Details</button>
            <button class="btn btn-small copy-link-btn" data-id="${product.id}"><i class="fas fa-link"></i> Copy Link</button>
          </div>
          <div class="product-card-controls">
            <button class="quantity-btn" data-action="dec">-</button>
            <input type="number" value="1" min="1" class="quantity-input" style="width:2.2em;">
            <button class="quantity-btn" data-action="inc">+</button>
            <button class="add-to-cart-btn" data-id="${product.id}">Add to Cart</button>
          </div>
        </div>
      `;
      grid.appendChild(card);
    });
    // Add event listeners for quantity, add to cart, and copy link (standardized)
    grid.querySelectorAll('.product-card').forEach((card, idx) => {
      const qtyInput = card.querySelector('.quantity-input');
      card.querySelector('[data-action="dec"]').onclick = () => {
        let v = parseInt(qtyInput.value) || 1;
        if (v > 1) qtyInput.value = v - 1;
      };
      card.querySelector('[data-action="inc"]').onclick = () => {
        let v = parseInt(qtyInput.value) || 1;
        qtyInput.value = v + 1;
      };
      card.querySelector('.add-to-cart-btn').onclick = () => {
        let v = parseInt(qtyInput.value) || 1;
        window.CategoryProducts.addToCart(productsToShow[idx], v);
      };
      // Copy Link button logic (standardized)
      card.querySelector('.copy-link-btn').onclick = function(e) {
        e.preventDefault();
        const productId = this.getAttribute('data-id');
        const product = productsToShow[idx];
        if (window.productRouter && product) {
          window.productRouter.copyProductLink(productId, product.name);
        }
        // Show confirmation message
        let conf = document.getElementById('copyLinkConfirmMsg');
        if (!conf) {
          conf = document.createElement('div');
          conf.id = 'copyLinkConfirmMsg';
          conf.style.position = 'fixed';
          conf.style.top = '24px';
          conf.style.left = '50%';
          conf.style.transform = 'translateX(-50%)';
          conf.style.background = '#fff';
          conf.style.color = '#222';
          conf.style.border = '1.5px solid #b80000';
          conf.style.borderRadius = '8px';
          conf.style.boxShadow = '0 4px 24px rgba(0,0,0,0.13)';
          conf.style.padding = '1.1em 2.2em';
          conf.style.fontSize = '1.08rem';
          conf.style.fontWeight = '600';
          conf.style.zIndex = '10000';
          conf.style.display = 'none';
          document.body.appendChild(conf);
        }
        conf.innerHTML = '<i class="fas fa-link" style="color:#b80000;margin-right:0.6em;"></i> Product link copied!';
        conf.style.display = 'block';
        setTimeout(() => { conf.style.display = 'none'; }, 1800);
      };
    });
  },
  setupPagination: function() {
    const page1 = document.getElementById('page1');
    const page2 = document.getElementById('page2');
    if (!page1 || !page2) return;
    page1.onclick = () => {
      this.currentPage = 1;
      this.renderProducts(1);
      page1.classList.add('active');
      page2.classList.remove('active');
    };
    page2.onclick = () => {
      this.currentPage = 2;
      this.renderProducts(2);
      page2.classList.add('active');
      page1.classList.remove('active');
    };
  },
  setupDetailsModal: function() {
    const grid = document.getElementById('categoryProducts');
    const closeBtn = document.getElementById('closeDetailBtn');
    const backBtn = document.getElementById('backToCatalogBtn');
    if (!grid || !closeBtn || !backBtn) return;
    grid.onclick = function(e) {
      if (e.target.classList.contains('see-details-btn')) {
        const productId = parseInt(e.target.getAttribute('data-id'));
        this.showProductDetail(productId);
      }
    }.bind(this);
    closeBtn.onclick = this.hideProductDetail;
    backBtn.onclick = this.hideProductDetail;
  },
  addToCart: function(product, qty) {
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const existing = cart.find(item => item.id === product.id);
    if (existing) {
      existing.qty = Number(existing.qty || 0) + Number(qty || 1);
    } else {
      cart.push({ id: product.id, title: product.name, price: product.price, qty: Number(qty || 1), image: product.image });
    }
    localStorage.setItem('cart', JSON.stringify(cart));
    // Update cart count in header if present
    let totalCount = cart.reduce((sum, item) => Number(sum) + Number(item.qty || 0), 0);
    let cartCount = document.querySelector('.cart-count');
    if (cartCount) cartCount.textContent = totalCount;
    // Confirmation message
    let conf = document.getElementById('cartConfirmMsg');
    if (!conf) {
      conf = document.createElement('div');
      conf.id = 'cartConfirmMsg';
      conf.style.position = 'fixed';
      conf.style.top = '24px';
      conf.style.left = '50%';
      conf.style.transform = 'translateX(-50%)';
      conf.style.background = '#fff';
      conf.style.color = '#222';
      conf.style.border = '1.5px solid #b80000';
      conf.style.borderRadius = '8px';
      conf.style.boxShadow = '0 4px 24px rgba(0,0,0,0.13)';
      conf.style.padding = '1.1em 2.2em';
      conf.style.fontSize = '1.08rem';
      conf.style.fontWeight = '600';
      conf.style.zIndex = '10000';
      conf.style.display = 'none';
      document.body.appendChild(conf);
    }
    conf.innerHTML = `<i class="fas fa-check-circle" style="color:#b80000;margin-right:0.6em;"></i> ${qty} × <b>${product.name}</b> added to cart!`;
    conf.style.display = 'block';
    setTimeout(() => { conf.style.display = 'none'; }, 2200);
  },
  showProductDetail: function(productId) {
    const product = this.products.find(p => p.id === productId);
    if (!product) return;
    const modal = document.getElementById('productDetailModal');
    if (!modal) return;
    modal.innerHTML = `
      <div class="product-detail-content">
          <button class="close-detail" onclick="window.CategoryProducts.hideProductDetail()">&times;</button>
          <div class="product-detail-header">
              <h2>${product.name}</h2>
          </div>
          <div class="product-detail-body">
              <div class="product-images" id="modalProductImgs">
                  ${product.images.map(img => `<img src="${img}" alt="${product.name}" class="modal-img-thumb" style="width:160px;height:110px;object-fit:contain;margin:0.5em;cursor:pointer;border-radius:8px;background:#f7f7f7;border:1px solid #eee;">`).join("")}
              </div>
              <div class="product-info">
                  <div class="product-price">$${product.price.toFixed(2)}</div>
                  <div class="product-description">${product.description}</div>
                  <div style="display:flex;gap:0.5em;align-items:center;margin-bottom:0.7em;">
                    <button class="btn btn-small copy-link-btn-modal" data-id="${product.id}"><i class="fas fa-link"></i> Copy Link</button>
                  </div>
                  <div class="quantity-controls" style="display:flex;align-items:center;gap:0.7rem;margin-bottom:1.2rem;">
                      <button class="quantity-btn" id="qtyDecModal">-</button>
                      <input type="number" value="1" min="1" class="quantity-input" id="qtyValModal" style="width:2.2em;">
                      <button class="quantity-btn" id="qtyIncModal">+</button>
                  </div>
                  <button class="add-to-cart-btn" id="modalAddToCartBtn" style="width:100%;margin-bottom:0.7rem;">Add to Cart</button>
                  <button class="btn btn-secondary" onclick="window.CategoryProducts.hideProductDetail()">Back to Catalog</button>
              </div>
          </div>
      </div>
    `;
    // Copy Link button logic for modal (standardized, only once)
    const copyBtnModal = modal.querySelector('.copy-link-btn-modal');
    if (copyBtnModal) {
      copyBtnModal.onclick = function(e) {
        e.preventDefault();
        if (window.productRouter && product) {
          window.productRouter.copyProductLink(product.id, product.name);
        }
        // Show confirmation message
          let conf = document.getElementById('copyLinkConfirmMsg');
          if (!conf) {
            conf = document.createElement('div');
            conf.id = 'copyLinkConfirmMsg';
            conf.style.position = 'fixed';
            conf.style.top = '24px';
            conf.style.left = '50%';
            conf.style.transform = 'translateX(-50%)';
            conf.style.background = '#fff';
            conf.style.color = '#222';
            conf.style.border = '1.5px solid #b80000';
            conf.style.borderRadius = '8px';
            conf.style.boxShadow = '0 4px 24px rgba(0,0,0,0.13)';
            conf.style.padding = '1.1em 2.2em';
            conf.style.fontSize = '1.08rem';
            conf.style.fontWeight = '600';
            conf.style.zIndex = '10000';
            conf.style.display = 'none';
            document.body.appendChild(conf);
          }
          conf.innerHTML = '<i class="fas fa-link" style="color:#b80000;margin-right:0.6em;"></i> Product link copied!';
          conf.style.display = 'block';
          setTimeout(() => { conf.style.display = 'none'; }, 1800);
        });
      };
    }
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
    // Modal quantity logic
    const qtyInput = modal.querySelector('#qtyValModal');
    modal.querySelector('#qtyDecModal').onclick = () => {
      let v = parseInt(qtyInput.value) || 1;
      if (v > 1) qtyInput.value = v - 1;
    };
    modal.querySelector('#qtyIncModal').onclick = () => {
      let v = parseInt(qtyInput.value) || 1;
      qtyInput.value = v + 1;
    };
    modal.querySelector('#modalAddToCartBtn').onclick = () => {
      let v = parseInt(qtyInput.value) || 1;
      window.CategoryProducts.addToCart(product, v);
    };
    // Lightbox logic
    modal.querySelectorAll('.modal-img-thumb').forEach(img => {
      img.onclick = function() {
        const lightbox = document.createElement('div');
        lightbox.className = 'lightbox-modal';
        lightbox.innerHTML = `<button class='close-lightbox'>&times;</button><img src='${img.src}' style='max-width:90vw;max-height:85vh;'>`;
        document.body.appendChild(lightbox);
        lightbox.querySelector('.close-lightbox').onclick = () => lightbox.remove();
        lightbox.onclick = (e) => { if (e.target === lightbox) lightbox.remove(); };
      };
    });
  },
  hideProductDetail: function() {
    const modal = document.getElementById('productDetailModal');
    if (modal) {
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }
  }
};

document.addEventListener('DOMContentLoaded', function() {
  if (document.getElementById('categoryProducts')) {
    window.CategoryProducts.renderProducts(1);
    window.CategoryProducts.setupPagination();
    window.CategoryProducts.setupDetailsModal();
    const page1 = document.getElementById('page1');
    if (page1) page1.classList.add('active');

    // Pretty URL: open product modal if /[id]-[slug] is in the path
    const pathMatch = window.location.pathname.match(/(?:\/|^)(\d+)-[a-z0-9-]+$/);
    if (pathMatch && pathMatch[1]) {
      const prodId = parseInt(pathMatch[1]);
      setTimeout(function() {
        window.CategoryProducts.showProductDetail(prodId);
      }, 200);
    }
  }
});
