window.CategoryProducts = {
  products: [
    {
      id: 701,
      name: 'VLAND Sequential LED Headlights for Toyota 86 / Subaru BRZ (GT86 Style)',
      price: 450,
      image: '51a.jpg',
      images: ['51b.jpg', '51c.jpg'],
      description: `Transform the front-end aesthetics and lighting performance of your Toyota 86 or Subaru BRZ with this striking set of VLAND sequential LED headlights. These aftermarket units are designed to provide a modern, aggressive look inspired by the latest automotive lighting trends, incorporating dynamic sequential turn signals that command attention. Engineered for a direct fit, these headlights offer a significant visual upgrade over factory units, enhancing both the vehicle's presence and nighttime visibility. With their distinctive LED daytime running lights and sharp, precise light output, they deliver both style and functionality, making them an ideal enhancement for enthusiasts seeking a contemporary and high-impact modification.

`
    },
    {
      id: 702,
      name: 'DEPO Tri-Bar LED Tail Lights with Clear Side Markers',
      price: 380,
      image: '52a.jpg',
      images: ['52b.jpg', '52c.jpg'],
      description: `Give your vehicle's rear end a sleek, modern update with these eye-catching DEPO Tri-Bar LED tail lights, thoughtfully paired with crystal-clear side markers. The lenses themselves are in fantastic shape, ensuring a crisp, bright output that will immediately refresh your car's look. You might notice a couple of incredibly tiny water spots on the very top edge of the chrome housing, but they're so minor they practically disappear once installed. This set offers a compelling and stylish way to stand out, bringing both a unique lighting signature and a clean, updated aesthetic to your vehicle.`
    },
    {
      id: 703,
      name: 'VLAND Smoked Clear Sequential Taillights for FR-S, BRZ, and 86',
      price: 355,
      image: '53a.jpg',
      images: ['53b.jpg', '53c.jpg'],
      description: `Update the rear look of your FR-S, BRZ, or 86 with a brand-new set of VLAND Smoked Clear Sequential Taillights. These lights are still in their original box, only opened briefly for pictures, meaning they're absolutely pristine and ready for installation.

Once in place, you'll immediately notice the full LED upgrade, providing brighter and crisper illumination than stock. But the real showstopper? Those dynamic sequential turn signals that sweep across, giving your car a truly modern and high-end feel. Plus, the integrated boomerang daytime running light adds a sharp, distinctive signature whenever your lights are on. It's a complete visual transformation that brings contemporary style and enhanced visibility to your vehicle.`
    },
    {
      id: 704,
      name: `
Valenti Revo Jewel Sequential Taillights (Clear/Gold) for FR-S, BRZ, and 86`,
      price: 375,
      image: '54a.jpg',
      images: ['54b.jpg', '54c.jpg'],
      description: `Transform the rear end of your FR-S, BRZ, or 86 with a set of Valenti Revo Jewel Sequential Taillights. These stunning clear and gold lights, though lightly used, perform flawlessly with no issues or dead LEDs. In fact, their lenses have just received a fresh clean and polish, ensuring they look exceptionally sharp.

You'll appreciate the full LED upgrade, delivering brighter and crisper illumination than standard lights. The integrated sequential turn signals offer a smooth, modern sweep, while the distinctive boomerang daytime running light provides an unmistakable signature, enhancing your car's presence both day and night. This set brings a truly high-end, custom look and reliable performance to your vehicle.`
    },
    {
      id: 705,
      name: 'HRS Elite Series LED Tail Lights for 2022-2023 Toyota GR86 and Subaru BRZ',
      price: 420,
      image: '55a.jpg',
      images: ['55b.jpg', '55c.jpg'],
      description: `Upgrade the rear lighting on your 2022-2023 Toyota GR86 or Subaru BRZ with the striking HRS Elite Series LED Tail Lights. These lights are in excellent condition, ready to transform your vehicle's appearance with a distinct and modern LED signature. They offer a direct-fit solution that not only enhances visibility but also provides a more aggressive and contemporary aesthetic to your car's rear end. This is a perfect choice for anyone looking to make a clean, impactful upgrade to their newer generation GR86 or BRZ.`
    },
    {
      id: 706,
      name: 'GT86 / FR-S / BRZ Track Box with Illuminated Switches',
      price: 275,
      image: '56a.jpg',
      images: ['56b.jpg', '56c.jpg'],
      description: `Unleash the full potential of your GT86, FR-S, or BRZ on the track with this specialized control box featuring illuminated switches. This essential tool for performance driving works flawlessly and without issues, providing direct command over several key vehicle functions. It allows you to completely disable traction control, effectively performing the "pedal dance" with a simple switch. Furthermore, you gain the ability to disable ABS braking for ultimate control, manage your cooling fan's function precisely, eliminate the intrusive seat belt chime, and even deactivate the auto door lock feature. This track box is a crucial addition for enthusiasts and racers seeking complete command over their vehicle's dynamics in a dedicated driving environment.

`
    },
    {
      id: 707,
      name: 'Valenti Jewel Headlights for Scion FR-S, Subaru BRZ, and Toyota 86',
      price: 460,
      image: '57a.jpg',
      images: ['57b.jpg', '57c.jpg'],
      description: `Here's an exceptional opportunity to acquire a brand-new set of Valenti Jewel headlights, still in their original packaging, for your Scion FR-S, Subaru BRZ, or Toyota 86. These highly sought-after units are now discontinued, making them incredibly difficult to find in this pristine, never-installed condition. Known for their distinctive design and superior illumination, Valenti Jewel headlights provide a significant aesthetic upgrade, transforming your vehicle's front end with a premium, crystalline look that stands apart. This is a rare chance for enthusiasts to secure a piece of aftermarket lighting history and elevate their car's presence with a truly unique and discontinued component.`
    },
    {
      id: 708,
      name: 'OpenFlash Tablet (OFT) Tuners for FR-S, BRZ, and 86 Platforms (V1 & V2 Available)',
      price: 500,
      image: '58a.jpg',
      images: ['58b.jpg', '58c.jpg'],
      description: `Unlock the full performance potential of your FR-S, BRZ, or 86 with these OpenFlash Tablet (OFT) tuners. We have both a V1 and a V2 unit available, each in good working condition and ready to dramatically enhance your vehicle's driving experience. The OFT V2 comes pre-loaded with a potent Stage 2+ E85 tune, offering significant power gains and optimized performance for compatible setups. Meanwhile, the OFT V1 provides two distinct tunes, allowing for versatile calibration options right out of the box. Both tuners are prepared for immediate use, providing a straightforward pathway to improved engine response and horsepower for your sport compact.`
    },
    {
      id: 709,
      name: 'OEM Reverse Light / Third Brake Light for Scion FR-S, Toyota 86, and Subaru BRZ',
      price: 170,
      image: '59a.jpg',
      images: ['59b.jpg', '59c.jpg'],
      description: `Acquire an authentic OEM reverse light, also functioning as the third brake light, for your sport compact. This unit originally came from a 2013 Scion FR-S, and it's fully compatible with all 2012 to 2016 Subaru BRZ and Toyota 86 models, ensuring a perfect fit and seamless integration. It's an ideal choice for anyone looking to replace a damaged unit or simply seeking a genuine, reliable component to maintain their vehicle's original integrity and safety features.`
    },
    {
      id: 710,
      name: 'VLAND Sequential LED Headlights for Scion FR-S, Subaru BRZ, and Toyota 86',
      price: 440,
      image: '60a.jpg',
      images: ['60b.jpg', '60c.jpg'],
      description: `Upgrade the front-end styling and illumination of your 2013-2021 Scion FR-S, Subaru BRZ, or Toyota 86 with a brand-new set of VLAND sequential LED headlights. These striking lights are in excellent, pristine condition and are ready to dramatically transform your vehicle's appearance. They feature dynamic sequential turn signals that sweep across, providing a truly modern and high-end visual effect, along with powerful LED headlight bulbs for superior nighttime visibility. This set offers a direct-fit solution, making it a perfect choice for enthusiasts seeking a contemporary and impactful lighting upgrade.

`
    }
   
  ],
  productsPerPage: 5,
  currentPage: 1,
  renderProducts: function(page) {
    const grid = document.getElementById('categoryProducts');
    if (!grid) return;
    const start = (page - 1) * this.productsPerPage;
    const end = start + this.productsPerPage;
    const productsToShow = this.products.slice(start, end);
    grid.innerHTML = '';
    productsToShow.forEach((product, idx) => {
      const card = document.createElement('div');
      card.className = 'product-card';
      card.setAttribute('data-product-id', product.id);
      card.innerHTML = `
        <img src="${product.image}" alt="${product.name}" class="product-image">
        <div class="product-info">
          <h3 class="product-title">${product.name}</h3>
          <div class="product-price">$${product.price}</div>
          <button class="btn btn-small see-details-btn" data-id="${product.id}">See Details</button>
          <button class="btn btn-small copy-link-btn" data-id="${product.id}" style="margin-left:0.5em;"><i class='fas fa-link'></i> Copy Link</button>
          <div class="product-card-controls">
            <button class="quantity-btn" data-action="dec">-</button>
            <input type="number" value="1" min="1" class="quantity-input" style="width:2.2em;">
            <button class="quantity-btn" data-action="inc">+</button>
            <button class="add-to-cart-btn" data-id="${product.id}">Add to Cart</button>
          </div>
        </div>
      `;
      grid.appendChild(card);
    });
    // Add event listeners for quantity and add to cart
    grid.querySelectorAll('.product-card').forEach((card, idx) => {
      const qtyInput = card.querySelector('.quantity-input');
      card.querySelector('[data-action="dec"]').onclick = () => {
        let v = parseInt(qtyInput.value) || 1;
        if (v > 1) qtyInput.value = v - 1;
      };
      card.querySelector('[data-action="inc"]').onclick = () => {
        let v = parseInt(qtyInput.value) || 1;
        qtyInput.value = v + 1;
      };
      card.querySelector('.add-to-cart-btn').onclick = () => {
        let v = parseInt(qtyInput.value) || 1;
        window.CategoryProducts.addToCart(productsToShow[idx], v);
      };
      // Copy Link button logic
      card.querySelector('.copy-link-btn').onclick = function(e) {
        e.preventDefault();
        const productId = this.getAttribute('data-id');
        let url = window.location.origin + window.location.pathname;
        if (productId) {
          url += '?product=' + encodeURIComponent(productId);
        }
        navigator.clipboard.writeText(url).then(function() {
          let conf = document.getElementById('copyLinkConfirmMsg');
          if (!conf) {
            conf = document.createElement('div');
            conf.id = 'copyLinkConfirmMsg';
            conf.style.position = 'fixed';
            conf.style.top = '24px';
            conf.style.left = '50%';
            conf.style.transform = 'translateX(-50%)';
            conf.style.background = '#fff';
            conf.style.color = '#222';
            conf.style.border = '1.5px solid #b80000';
            conf.style.borderRadius = '8px';
            conf.style.boxShadow = '0 4px 24px rgba(0,0,0,0.13)';
            conf.style.padding = '1.1em 2.2em';
            conf.style.fontSize = '1.08rem';
            conf.style.fontWeight = '600';
            conf.style.zIndex = '10000';
            conf.style.display = 'none';
            document.body.appendChild(conf);
          }
          conf.innerHTML = '<i class="fas fa-link" style="color:#b80000;margin-right:0.6em;"></i> Product link copied!';
          conf.style.display = 'block';
          setTimeout(() => { conf.style.display = 'none'; }, 1800);
        });
      };
    });
    // Add event listeners for quantity and add to cart
    grid.querySelectorAll('.product-card').forEach((card, idx) => {
      const qtyInput = card.querySelector('.quantity-input');
      card.querySelector('[data-action="dec"]').onclick = () => {
        let v = parseInt(qtyInput.value) || 1;
        if (v > 1) qtyInput.value = v - 1;
      };
      card.querySelector('[data-action="inc"]').onclick = () => {
        let v = parseInt(qtyInput.value) || 1;
        qtyInput.value = v + 1;
      };
      card.querySelector('.add-to-cart-btn').onclick = () => {
        let v = parseInt(qtyInput.value) || 1;
        window.CategoryProducts.addToCart(productsToShow[idx], v);
      };
    });
  },
  setupPagination: function() {
    const page1 = document.getElementById('page1');
    const page2 = document.getElementById('page2');
    if (!page1 || !page2) return;
    page1.onclick = () => {
      this.currentPage = 1;
      this.renderProducts(1);
      page1.classList.add('active');
      page2.classList.remove('active');
    };
    page2.onclick = () => {
      this.currentPage = 2;
      this.renderProducts(2);
      page2.classList.add('active');
      page1.classList.remove('active');
    };
  },
  setupDetailsModal: function() {
    const grid = document.getElementById('categoryProducts');
    const closeBtn = document.getElementById('closeDetailBtn');
    const backBtn = document.getElementById('backToCatalogBtn');
    if (!grid || !closeBtn || !backBtn) return;
    grid.onclick = function(e) {
      if (e.target.classList.contains('see-details-btn')) {
        const productId = parseInt(e.target.getAttribute('data-id'));
        this.showProductDetail(productId);
      }
    }.bind(this);
    closeBtn.onclick = this.hideProductDetail;
    backBtn.onclick = this.hideProductDetail;
  },
  addToCart: function(product, qty) {
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const existing = cart.find(item => item.id === product.id);
    if (existing) {
      existing.qty = Number(existing.qty || 0) + Number(qty || 1);
    } else {
      cart.push({ id: product.id, title: product.name, price: product.price, qty: Number(qty || 1), image: product.image });
    }
    localStorage.setItem('cart', JSON.stringify(cart));
    // Update cart count in header if present
    let totalCount = cart.reduce((sum, item) => Number(sum) + Number(item.qty || 0), 0);
    let cartCount = document.querySelector('.cart-count');
    if (cartCount) cartCount.textContent = totalCount;
    // Confirmation message
    let conf = document.getElementById('cartConfirmMsg');
    if (!conf) {
      conf = document.createElement('div');
      conf.id = 'cartConfirmMsg';
      conf.style.position = 'fixed';
      conf.style.top = '24px';
      conf.style.left = '50%';
      conf.style.transform = 'translateX(-50%)';
      conf.style.background = '#fff';
      conf.style.color = '#222';
      conf.style.border = '1.5px solid #b80000';
      conf.style.borderRadius = '8px';
      conf.style.boxShadow = '0 4px 24px rgba(0,0,0,0.13)';
      conf.style.padding = '1.1em 2.2em';
      conf.style.fontSize = '1.08rem';
      conf.style.fontWeight = '600';
      conf.style.zIndex = '10000';
      conf.style.display = 'none';
      document.body.appendChild(conf);
    }
    conf.innerHTML = `<i class="fas fa-check-circle" style="color:#b80000;margin-right:0.6em;"></i> ${qty} Ã— <b>${product.name}</b> added to cart!`;
    conf.style.display = 'block';
    setTimeout(() => { conf.style.display = 'none'; }, 2200);
  },
  showProductDetail: function(productId) {
    const product = this.products.find(p => p.id === productId);
    if (!product) return;
    const modal = document.getElementById('productDetailModal');
    if (!modal) return;
    modal.innerHTML = `
      <div class="product-detail-content">
          <button class="close-detail" onclick="window.CategoryProducts.hideProductDetail()">&times;</button>
          <div class="product-detail-header">
              <h2>${product.name}</h2>
          </div>
          <div class="product-detail-body">
              <div class="product-images" id="modalProductImgs">
                  ${product.images.map(img => `<img src="${img}" alt="${product.name}" class="modal-img-thumb" style="width:160px;height:110px;object-fit:contain;margin:0.5em;cursor:pointer;border-radius:8px;background:#f7f7f7;border:1px solid #eee;">`).join("")}
              </div>
              <div class="product-info">
                  <div class="product-price">$${product.price.toFixed(2)}</div>
                  <div class="product-description">${product.description}</div>
                  <button class="btn btn-secondary" id="copyProductLinkBtn" style="margin-bottom:0.7rem;display:flex;align-items:center;gap:0.5em;"><i class='fas fa-link'></i> Copy Link</button>
                  <div class="quantity-controls" style="display:flex;align-items:center;gap:0.7rem;margin-bottom:1.2rem;">
                      <button class="quantity-btn" id="qtyDecModal">-</button>
                      <input type="number" value="1" min="1" class="quantity-input" id="qtyValModal" style="width:2.2em;">
                      <button class="quantity-btn" id="qtyIncModal">+</button>
                  </div>
                  <button class="add-to-cart-btn" id="modalAddToCartBtn" style="width:100%;margin-bottom:0.7rem;">Add to Cart</button>
                  <button class="btn btn-secondary" onclick="window.CategoryProducts.hideProductDetail()">Back to Catalog</button>
              </div>
          </div>
      </div>
    `;
    // ...existing code for modal logic...
    // Copy Link button logic for modal
    modal.querySelector('#copyProductLinkBtn').onclick = function(e) {
      e.preventDefault();
      let url = window.location.origin + window.location.pathname;
      if (product.id) {
        url += '?product=' + encodeURIComponent(product.id);
      }
      navigator.clipboard.writeText(url).then(function() {
        let conf = document.getElementById('copyLinkConfirmMsg');
        if (!conf) {
          conf = document.createElement('div');
          conf.id = 'copyLinkConfirmMsg';
          conf.style.position = 'fixed';
          conf.style.top = '24px';
          conf.style.left = '50%';
          conf.style.transform = 'translateX(-50%)';
          conf.style.background = '#fff';
          conf.style.color = '#222';
          conf.style.border = '1.5px solid #b80000';
          conf.style.borderRadius = '8px';
          conf.style.boxShadow = '0 4px 24px rgba(0,0,0,0.13)';
          conf.style.padding = '1.1em 2.2em';
          conf.style.fontSize = '1.08rem';
          conf.style.fontWeight = '600';
          conf.style.zIndex = '10000';
          conf.style.display = 'none';
          document.body.appendChild(conf);
        }
        conf.innerHTML = '<i class="fas fa-link" style="color:#b80000;margin-right:0.6em;"></i> Product link copied!';
        conf.style.display = 'block';
        setTimeout(() => { conf.style.display = 'none'; }, 1800);
      });
    };
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
    // Modal quantity logic
    const qtyInput = modal.querySelector('#qtyValModal');
    modal.querySelector('#qtyDecModal').onclick = () => {
      let v = parseInt(qtyInput.value) || 1;
      if (v > 1) qtyInput.value = v - 1;
    };
    modal.querySelector('#qtyIncModal').onclick = () => {
      let v = parseInt(qtyInput.value) || 1;
      qtyInput.value = v + 1;
    };
    modal.querySelector('#modalAddToCartBtn').onclick = () => {
      let v = parseInt(qtyInput.value) || 1;
      window.CategoryProducts.addToCart(product, v);
    };
    // Lightbox logic
    modal.querySelectorAll('.modal-img-thumb').forEach(img => {
      img.onclick = function() {
        const lightbox = document.createElement('div');
        lightbox.className = 'lightbox-modal';
        lightbox.innerHTML = `<button class='close-lightbox'>&times;</button><img src='${img.src}' style='max-width:90vw;max-height:85vh;'>`;
        document.body.appendChild(lightbox);
        lightbox.querySelector('.close-lightbox').onclick = () => lightbox.remove();
        lightbox.onclick = (e) => { if (e.target === lightbox) lightbox.remove(); };
      };
    });
  },
  hideProductDetail: function() {
    const modal = document.getElementById('productDetailModal');
    if (modal) {
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }
  }
};

document.addEventListener('DOMContentLoaded', function() {
  if (document.getElementById('categoryProducts')) {
    window.CategoryProducts.renderProducts(1);
    window.CategoryProducts.setupPagination();
    window.CategoryProducts.setupDetailsModal();
    const page1 = document.getElementById('page1');
    if (page1) page1.classList.add('active');
  }
});
